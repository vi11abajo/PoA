<!DOCTYPE html>
<html>
<head>
    <title>Check Game Contract Address</title>
    <style>
        body { font-family: monospace; background: #001122; color: #00ddff; padding: 20px; }
        .result { background: #003366; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #660000; }
        .success { background: #006600; }
        button { background: #00ddff; color: #001122; padding: 10px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>🔍 Check Game Contract Address in V2</h2>
    
    <button onclick="checkGameContract()">Check Game Contract Address</button>
    <button onclick="checkOwner()">Check Contract Owner</button>
    <button onclick="disableGameContract()">Disable Game Contract (Owner only)</button>
    
    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.10.0/web3.min.js"></script>
    <script>
        const CONTRACT_ADDRESS = '0x494E3fb474fC5399E40EB2e0ED04D3DB9266A2d4';
        
        const CONTRACT_ABI = [
            {
                "inputs": [],
                "name": "gameContractAddress",
                "outputs": [{"name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [{"name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"name": "_newGameContractAddress", "type": "address"}],
                "name": "updateGameContract",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        let web3;
        let contract;
        let playerAccount;

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('results').appendChild(div);
        }

        async function initWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    playerAccount = accounts[0];
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    log(`✅ Connected: ${playerAccount}`, 'success');
                    return true;
                } catch (error) {
                    log(`❌ Connection failed: ${error.message}`, 'error');
                    return false;
                }
            } else {
                log('❌ MetaMask not found', 'error');
                return false;
            }
        }

        async function checkGameContract() {
            if (!contract && !(await initWeb3())) return;
            
            try {
                const gameContractAddr = await contract.methods.gameContractAddress().call();
                log(`🎮 Game Contract Address: ${gameContractAddr}`, 'info');
                
                if (gameContractAddr === '0x0000000000000000000000000000000000000000') {
                    log('✅ Game contract verification is DISABLED (address = 0x0)', 'success');
                } else {
                    log(`⚠️ Game contract verification is ENABLED! This might cause submitScore to fail!`, 'error');
                    log(`🔧 Game contract address: ${gameContractAddr}`, 'info');
                }
                
            } catch (error) {
                log(`❌ Error checking game contract: ${error.message}`, 'error');
            }
        }

        async function checkOwner() {
            if (!contract && !(await initWeb3())) return;
            
            try {
                const owner = await contract.methods.owner().call();
                log(`👑 Contract Owner: ${owner}`, 'info');
                
                if (owner.toLowerCase() === playerAccount.toLowerCase()) {
                    log('✅ You are the contract owner! You can disable game verification.', 'success');
                } else {
                    log('ℹ️ You are not the contract owner.', 'info');
                }
                
            } catch (error) {
                log(`❌ Error checking owner: ${error.message}`, 'error');
            }
        }

        async function disableGameContract() {
            if (!contract && !(await initWeb3())) return;
            
            try {
                log('🔧 Attempting to disable game contract verification...', 'info');
                
                const tx = await contract.methods.updateGameContract('0x0000000000000000000000000000000000000000').send({
                    from: playerAccount,
                    gas: 100000
                });
                
                log(`✅ Game contract verification DISABLED! TX: ${tx.transactionHash}`, 'success');
                log('🎮 Now submitScore should work without game verification!', 'success');
                
            } catch (error) {
                log(`❌ Failed to disable game contract: ${error.message}`, 'error');
                if (error.message.includes('Only owner')) {
                    log('❌ You are not the contract owner!', 'error');
                }
            }
        }

        // Auto-initialize
        window.addEventListener('load', async () => {
            log('🚀 Game contract debug tool loaded.');
            await checkGameContract();
            await checkOwner();
        });
    </script>
</body>
</html>