<!DOCTYPE html>
<html>
<head>
    <title>Debug New V2 Contract</title>
    <style>
        body { font-family: monospace; background: #001122; color: #00ddff; padding: 20px; }
        .result { background: #003366; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #660000; }
        .success { background: #006600; }
        button { background: #00ddff; color: #001122; padding: 10px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>üîç Debug New V2 Tournament Contract</h2>
    
    <div>
        <button onclick="checkTournamentStatus()">Check Tournament Status</button>
        <button onclick="checkPlayerRegistration()">Check Player Registration</button>
        <button onclick="checkPlayerAttempts()">Check Player Attempts</button>
        <button onclick="getContractInfo()">Get Contract Info</button>
    </div>
    
    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.10.0/web3.min.js"></script>
    <script>
        const CONTRACT_ADDRESS = '0x494E3fb474fC5399E40EB2e0ED04D3DB9266A2d4';
        const TOURNAMENT_ID = 2; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π ID —Ç—É—Ä–Ω–∏—Ä–∞
        
        // ABI –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π v2 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        const CONTRACT_ABI = [
            {
                "inputs": [{"name": "_tournamentId", "type": "uint256"}],
                "name": "getTournamentInfo",
                "outputs": [
                    {"name": "entryFee", "type": "uint256"},
                    {"name": "startTime", "type": "uint256"},
                    {"name": "endTime", "type": "uint256"},
                    {"name": "prizePool", "type": "uint256"},
                    {"name": "isActive", "type": "bool"},
                    {"name": "isFinished", "type": "bool"},
                    {"name": "participantCount", "type": "uint256"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "_tournamentId", "type": "uint256"},
                    {"name": "_player", "type": "address"}
                ],
                "name": "isPlayerRegistered",
                "outputs": [{"name": "", "type": "bool"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "_tournamentId", "type": "uint256"},
                    {"name": "_player", "type": "address"}
                ],
                "name": "getPlayerScore",
                "outputs": [
                    {"name": "score", "type": "uint256"},
                    {"name": "playerName", "type": "bytes32"},
                    {"name": "attempts", "type": "uint256"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "maxLeaderboardSize",
                "outputs": [{"name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "tournamentCounter",
                "outputs": [{"name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        let web3;
        let contract;
        let playerAccount;

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('results').appendChild(div);
        }

        async function initWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    playerAccount = accounts[0];
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    log(`‚úÖ Connected: ${playerAccount}`, 'success');
                    return true;
                } catch (error) {
                    log(`‚ùå Connection failed: ${error.message}`, 'error');
                    return false;
                }
            } else {
                log('‚ùå MetaMask not found', 'error');
                return false;
            }
        }

        async function checkTournamentStatus() {
            if (!contract && !(await initWeb3())) return;
            
            try {
                log('üîç Checking tournament status...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö ID —Ç—É—Ä–Ω–∏—Ä–æ–≤
                for (let tournamentId = 1; tournamentId <= 5; tournamentId++) {
                    try {
                        const info = await contract.methods.getTournamentInfo(tournamentId).call();
                        
                        log(`üìä Tournament ${tournamentId}:
                            Entry Fee: ${web3.utils.fromWei(info.entryFee, 'ether')} ETH
                            Start: ${new Date(info.startTime * 1000).toLocaleString()}
                            End: ${new Date(info.endTime * 1000).toLocaleString()}
                            Prize Pool: ${web3.utils.fromWei(info.prizePool, 'ether')} ETH
                            Active: ${info.isActive}
                            Finished: ${info.isFinished}
                            Participants: ${info.participantCount}`, 
                        info.isActive ? 'success' : 'info');
                    } catch (e) {
                        log(`‚ùå Tournament ${tournamentId}: Not found or error`, 'error');
                    }
                }
            } catch (error) {
                log(`‚ùå Error checking tournament: ${error.message}`, 'error');
            }
        }

        async function checkPlayerRegistration() {
            if (!contract && !(await initWeb3())) return;
            
            try {
                log('üîç Checking player registration...');
                
                for (let tournamentId = 1; tournamentId <= 5; tournamentId++) {
                    try {
                        const isRegistered = await contract.methods.isPlayerRegistered(tournamentId, playerAccount).call();
                        log(`üéØ Tournament ${tournamentId}: Registered = ${isRegistered}`, isRegistered ? 'success' : 'info');
                    } catch (e) {
                        log(`‚ùå Tournament ${tournamentId}: Error checking registration`, 'error');
                    }
                }
            } catch (error) {
                log(`‚ùå Error checking registration: ${error.message}`, 'error');
            }
        }

        async function checkPlayerAttempts() {
            if (!contract && !(await initWeb3())) return;
            
            try {
                log('üîç Checking player attempts...');
                
                for (let tournamentId = 1; tournamentId <= 5; tournamentId++) {
                    try {
                        const playerData = await contract.methods.getPlayerScore(tournamentId, playerAccount).call();
                        log(`üéØ Tournament ${tournamentId}:
                            Score: ${playerData.score}
                            Name: ${web3.utils.hexToUtf8(playerData.playerName)}
                            Attempts: ${playerData.attempts}/3`, 
                        playerData.attempts > 0 ? 'success' : 'info');
                    } catch (e) {
                        log(`‚ùå Tournament ${tournamentId}: Error checking attempts`, 'error');
                    }
                }
            } catch (error) {
                log(`‚ùå Error checking attempts: ${error.message}`, 'error');
            }
        }

        async function getContractInfo() {
            if (!contract && !(await initWeb3())) return;
            
            try {
                log('üîç Getting contract info...');
                
                const maxLeaderboardSize = await contract.methods.maxLeaderboardSize().call();
                const tournamentCounter = await contract.methods.tournamentCounter().call();
                
                log(`üìã Contract Info:
                    Max Leaderboard Size: ${maxLeaderboardSize}
                    Tournament Counter: ${tournamentCounter}`, 'success');
                    
            } catch (error) {
                log(`‚ùå Error getting contract info: ${error.message}`, 'error');
            }
        }

        // Auto-initialize
        window.addEventListener('load', async () => {
            log('üöÄ Debug tool loaded. Click buttons to check contract status.');
        });
    </script>
</body>
</html>